{if $error|@count}
<p class="error">
{if $error.invalid_subscription}Hrm. That doesn't look like a valid subscription.
{elseif $error.unsubscribe}Ack! There was a problem unsubscribing. So far the robots have told me this: {$error.details|escape}
{else}{/if}
</p>
{/if}
<table id="subscriptions">
	<tr>
		<th>Subscription</th>
		<th>Created</th>
		<th>Verified</th>
		<th>Last update</th>
		<th style="border:none;">&#160;</th>
	</tr>
{foreach from=$topic_map item="row" key="topic_id"}
{if $row.enabled}

{if $subscriptions.$topic_id}
{foreach from=$subscriptions.$topic_id item="sub"}
	<tr>
{capture assign="label"}{if $sub.label}"{$sub.label}"{elseif $sub.topic_url.label}{$sub.topic_url.label|@ucfirst}{else}{$row.label|@ucfirst}{/if}{/capture}
{capture assign="title"}{if $sub.topic_url.label}{$sub.topic_url.label|@ucfirst}{else}{$row.label|@ucfirst}{/if}{/capture}

		<td><strong><a href="{$cfg.abs_root_url}{$sub.topic_url.url}" title="{$title|@trim|escape}">{$label|@trim|escape}</a></strong></td>
		<td>{$sub.created|date_format:"%b %d, %Y"|escape}</td>
		<td>{if $sub.verified}{$sub.verified|date_format:"%b %d, %Y"|escape}{else}&#8212;{/if}</td>
		<td>{if $sub.last_update}{$sub.last_update|date_format:"%b %d, %Y"|escape} at <strong>{$sub.last_update|date_format:"%l:%M %p"|escape}</strong>{else}&#8212;{/if}</td>
		<td>
			<form method="POST" action="{$cfg.abs_root_url}" style="margin:0;" onsubmit="{literal}javascript: if (! confirm('Are you sure you want to unsubscribe?')){ return false; }{/literal}">
				{$crumb_key|crumb_input}
				<input type="hidden" name="delete" value ="{$sub.topic_id|escape}-{$sub.id|escape}" />
				<input type="submit" value="unsubscribe" class="unsubscribe" />
			</form>
		</td>
	</tr>
{/foreach}

{if $row.has_args}
	<tr style="background-color:#ccc;">
		<td><strong><a href="{$cfg.abs_root_url}{$row.url}" title="create a new subscription for {$row.label|escape}">{$row.label|@ucfirst|escape}</a></strong></td>
		<td>&#160;</td>
		<td>&#160;</td>
		<td>&#160;</td>
		<td><a href="{$cfg.abs_root_url}{$row.url}">subscribe</a></td>
	</tr>
{/if}

{else}
	<tr>
		<td><strong><a href="{$cfg.abs_root_url}{$row.url}" title="create a nw subscription for {$row.label|escape}">{$row.label|@ucfirst|escape}</a></strong></td>
		<td>&#160;</td>
		<td>&#160;</td>
		<td>&#160;</td>
		<td><a href="{$cfg.abs_root_url}{$row.url}">subscribe</a></td>
	</tr>
{/if}
{/if}

{/foreach}
</table>

{if $subscriptions|@count}
<p style="font-size:small;margin-left:50px;font-style:italic;">There is also an still-experimental <a href="{$cfg.abs_root_url}photos/">blended stream</a> of every photo from all your subscriptions.</p>
{/if}
