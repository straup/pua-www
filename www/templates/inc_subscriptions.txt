{if $error|@count}
<p class="error">
{if $error.invalid_subscription}Hrm. That doesn't look like a valid subscription.
{elseif $error.unsubscribe}Ack! There was a problem unsubscribing. So far the robots have told me this: {$error.details|escape}
{else}{/if}
</p>
{/if}
<table id="subscriptions">
	<tr>
		<th>Subscription</th>
		<th>Created</th>
		<th>Verified</th>
		<th>Last update</th>
		<th>New photos</th>
		<th style="border:none;">&#160;</th>
	</tr>
{foreach from=$topic_map item="row" key="topic_id"}
{if $row.enabled}
	<tr>
{if $subscriptions.$topic_id}
{assign var="sub" value=$subscriptions.$topic_id}
		<td><strong><a href="{$cfg.abs_root_url}{$row.url}">{$row.label|@ucfirst|escape}</a></strong></td>
		<td>{$sub.created|date_format:"%b %d, %Y"|escape}</td>
		<td>{if $sub.verified}{$sub.verified|date_format:"%b %d, %Y"|escape}{else}&#8212;{/if}</td>
		<td>{if $sub.last_update}{$sub.last_update|date_format:"%b %d, %Y"|escape} at <strong>{$sub.last_update|date_format:"%l:%M %p"|escape}</strong>{else}&#8212;{/if}</td>
		<td class="number">{$sub.last_update_photo_count|escape}</td>
		<td>
			<form method="POST" action="{$cfg.abs_root_url}" style="margin:0;" onsubmit="{literal}javascript: if (! confirm('Are you sure you want to unsubscribe?')){ return false; }{/literal}">
				{$crumb_key|crumb_input}
				<input type="hidden" name="delete" value ="{$sub.topic_id|escape}-{$sub.id|escape}" />
				<input type="submit" value="unsubscribe" class="unsubscribe" />
			</form>
		</td>
{else}
		<td><strong><a href="{$cfg.abs_root_url}{$row.url}">{$row.label|@ucfirst|escape}</a></strong></td>
		<td><a href="{$cfg.abs_root_url}{$row.url}">subscribe</a></td>
		<td>&#160;</td>
		<td>&#160;</td>
{/if}
{/if}
	</tr>
{/foreach}
</table>

{if $subscriptions|@count}
<p style="font-size:small;margin-left:50px;font-style:italic;">There is also an still-experimental <a href="{$cfg.abs_root_url}photos/">blended stream</a> of both faves and photos from your contacts.</p>
{/if}
